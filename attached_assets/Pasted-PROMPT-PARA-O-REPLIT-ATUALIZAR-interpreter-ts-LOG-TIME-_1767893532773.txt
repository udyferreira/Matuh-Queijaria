PROMPT PARA O REPLIT ‚Äî ATUALIZAR interpreter.ts (LOG_TIME E QUERY_INPUT)
Contexto
O arquivo interpreter.ts j√° existe e hoje √© respons√°vel por interpretar o texto vindo da Alexa e retornar um objeto { intent, confidence, entities }.
Atualmente ele reconhece bem intents como start_batch, advance, status e timer, mas n√£o reconhece corretamente:
registro de hor√°rios de processo (ex: flocula√ß√£o)
consultas sobre insumos j√° calculados (ex: quantidade de LR, DX, KL, coalho)
Essas limita√ß√µes est√£o bloqueando o avan√ßo do fluxo na etapa de flocula√ß√£o e impedem perguntas operacionais b√°sicas.
üéØ Objetivo
Atualizar apenas o interpreter.ts para:
Reconhecer registro de hor√°rio de flocula√ß√£o (log_time)
Reconhecer consulta de insumos calculados (query_input)
Manter compatibilidade total com os intents j√° existentes
N√£o mover l√≥gica de neg√≥cio para o LLM (apenas interpreta√ß√£o)
üîß Altera√ß√µes obrigat√≥rias no interpreter.ts
1Ô∏è‚É£ Atualizar o prompt do LLM (system + user)
Modificar o prompt usado na fun√ß√£o de interpreta√ß√£o para incluir explicitamente:
reconhecimento de comandos de registro de dados
reconhecimento de comandos de consulta de insumos
O prompt deve instruir o LLM a:
retornar somente JSON
nunca inventar valores
converter hor√°rios falados para formato HH:MM
identificar log_time quando o usu√°rio disser algo como:
‚Äúa flocula√ß√£o foi √†s cinco e vinte‚Äù
‚Äúanota a flocula√ß√£o √†s dezessete e quarenta‚Äù
identificar query_input quando o usu√°rio disser algo como:
‚Äúqual a quantidade de LR‚Äù
‚Äúquanto de fermento DX eu uso‚Äù
‚Äúa quantidade de LR e DX‚Äù
2Ô∏è‚É£ Estender o schema de retorno
Garantir que o objeto retornado pelo interpreter.ts suporte estes novos campos, sem quebrar os existentes:
intent:
  | "status"
  | "start_batch"
  | "advance"
  | "timer"
  | "log_time"
  | "log_ph"
  | "log_temperature"
  | "query_input"
  | "help"
  | "unknown";

entities: {
  volume?: number | null;
  milk_temperature?: number | null;
  ph_value?: number | null;

  time_type?: "flocculation" | null;
  time_value?: string | null; // formato HH:MM

  input_type?: "FERMENT_LR" | "FERMENT_DX" | "FERMENT_KL" | "RENNET" | null;
}
3Ô∏è‚É£ Regras de interpreta√ß√£o (importante)
No interpreter.ts:
Se o usu√°rio mencionar flocula√ß√£o + hor√°rio, retornar:
intent = "log_time"
entities.time_type = "flocculation"
entities.time_value = "HH:MM"
Se o usu√°rio mencionar quantidade / quanto / dose + nome de insumo (LR, DX, KL, coalho):
retornar intent = "query_input"
mapear corretamente:
LR ‚Üí FERMENT_LR
DX ‚Üí FERMENT_DX
KL ‚Üí FERMENT_KL
coalho ‚Üí RENNET
Se o comando for amb√≠guo ou incompleto:
retornar intent = "unknown"
4Ô∏è‚É£ O que N√ÉO fazer
‚ùå N√£o executar l√≥gica de neg√≥cio no interpreter
‚ùå N√£o acessar batch, banco ou recipe no interpreter
‚ùå N√£o assumir valores que o usu√°rio n√£o disse
‚ùå N√£o criar intents novos na Alexa
‚úÖ Crit√©rio de aceite (testes manuais)
Ap√≥s a altera√ß√£o, estes comandos devem gerar o JSON correto no log:
‚Äúa flocula√ß√£o foi √†s cinco e vinte‚Äù
intent: log_time
time_type: flocculation
time_value: 05:20
‚Äúqual a quantidade de LR‚Äù
intent: query_input
input_type: FERMENT_LR
‚Äúquanto de DX e KL eu uso‚Äù
intent: query_input
input_type: m√∫ltiplos ou o primeiro identificado (decis√£o de implementa√ß√£o)
Comandos j√° existentes (advance, status, timer) continuam funcionando sem regress√£o.