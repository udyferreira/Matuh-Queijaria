ðŸ”§ PROMPT ÃšNICO PARA O REPLIT â€” CORREÃ‡ÃƒO DA ETAPA 15
Copie exatamente como estÃ¡ e cole no Replit.
ðŸ§© PROMPT
Contexto:
JÃ¡ existem os intents Alexa corretos (RegisterPHAndPiecesIntent, LogTimeIntent).
NÃ£o criar novos intents.
NÃ£o alterar o interaction model da Alexa.
O problema estÃ¡ exclusivamente no backend (interpreter.ts + lÃ³gica por etapa).
ðŸŽ¯ OBJETIVO
Corrigir a Etapa 15 (Virar queijos e medir pH â€“ loop controlado) para que:
Aceite corretamente pH via RegisterPHAndPiecesIntent
NÃ£o exija pieces_quantity
NÃ£o confunda com a Etapa 13
Controle corretamente o loop de 2 horas e o contador de viradas
Avance automaticamente se pH <= 5.2
âœ… MUDANÃ‡AS OBRIGATÃ“RIAS
1ï¸âƒ£ Parar de decidir comportamento pelo intent
âŒ Remover qualquer lÃ³gica do tipo:
if (intentName === "RegisterPHAndPiecesIntent") {
  // assume etapa 13
}
âœ… Substituir por lÃ³gica baseada exclusivamente no stage atual:
const stageId = batch.currentStageId;
2ï¸âƒ£ LÃ³gica correta para RegisterPHAndPiecesIntent
Implementar switch por etapa:
case 13:
  // pH + pieces
  break;

case 15:
  // pH apenas
  break;
3ï¸âƒ£ Comportamento correto da ETAPA 15
Ao receber RegisterPHAndPiecesIntent:
Ler apenas:
const phRaw = slots.ph_value?.value;
Ignorar completamente:
slots.pieces_quantity
Converter:
const ph = Number(phRaw) / 10;
4ï¸âƒ£ Fluxo da etapa 15
Se pH ainda nÃ£o medido:
"Informe o pH atual dos queijos."
Se pH > 5.2:
Registrar pH no histÃ³rico
Incrementar turningCyclesCount
Reiniciar timer de atÃ© 2 horas
Responder:
"pH {valor} registrado. Queijos virados {N} vez(es). 
Continue monitorando ou informe novo pH."
Se pH <= 5.2:
Registrar pH
Encerrar loop
AvanÃ§ar automaticamente para a prÃ³xima etapa
Responder:
"pH {valor} registrado. Valor ideal atingido. 
AvanÃ§ando para a prÃ³xima etapa."
5ï¸âƒ£ Remover qualquer mensagem invÃ¡lida
âŒ Nunca responder na etapa 15:
"Esta etapa nÃ£o requer pH e quantidade de peÃ§as"
Isso sÃ³ Ã© vÃ¡lido para etapas â‰  13 e â‰  15.
6ï¸âƒ£ Atualizar recipe.yml (se necessÃ¡rio)
Garantir que a etapa 15 tenha:
expected_intent: RegisterPHAndPiecesIntent
E NÃƒO tenha:
required_inputs: pieces_quantity
ðŸ“Œ RESUMO DO FIX
âœ… O intent estÃ¡ correto
âŒ A lÃ³gica do backend estÃ¡ acoplada Ã  etapa errada
âœ… Etapa 15 usa pH, mas nÃ£o usa peÃ§as
âœ… A decisÃ£o deve ser feita por stageId, nunca pelo intent isolado