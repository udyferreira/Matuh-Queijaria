ğŸ”§ Prompt â€“ Alinhamento completo do backend e interpreter com recipe.yml
Atualize o backend e o interpreter para cumprir rigorosamente o recipe.yml do QUEIJO_NETE, com as seguintes regras obrigatÃ³rias:
1. Controle de avanÃ§o de etapa
Antes de permitir advance, verificar:
Se a etapa atual possui operator_input_required
Se hÃ¡ inputs obrigatÃ³rios ainda nÃ£o preenchidos
Se existe timer.blocking = true ativo
Se qualquer condiÃ§Ã£o acima falhar:
Bloquear avanÃ§o
Guiar o usuÃ¡rio para fornecer o input faltante ou aguardar o timer
2. Modo de coleta por etapa (stage input lock)
Implementar um estado de bloqueio quando a etapa tiver inputs obrigatÃ³rios:
stageInputLock = {
  stageId,
  missingInputs[]
}
Enquanto o lock existir:
Ignorar intents de advance
Aceitar apenas intents que preencham os inputs faltantes
3. Mapeamento explÃ­cito de intents por etapa
Associar cada etapa com inputs obrigatÃ³rios Ã s intents corretas:
Etapa 6 â†’ LogTimeIntent (flocculation)
Etapa 7 â†’ LogTimeIntent (cut_point)
Etapa 13 â†’ RegisterPHAndPiecesIntent
Etapa 14 â†’ LogTimeIntent (press_start)
Etapa 19 â†’ RegisterChamber2EntryDateIntent
4. PersistÃªncia correta de valores
Garantir que:
ph_value seja armazenado como initial_ph na etapa 13
Todos os valores sejam registrados com stageId correto
Remover qualquer gravaÃ§Ã£o genÃ©rica como recorded_time
5. Loop da etapa 15
Implementar controle explÃ­cito de loop:
Cada ciclo registra um pH em ph_measurements[]
Incrementar turning_cycles_count
Encerrar loop se ph_value <= 5.2 ou se atingir 2 horas
6. Respeitar polÃ­tica do LLM
O LLM:
NÃ£o pode avanÃ§ar etapas
NÃ£o pode calcular proporÃ§Ãµes
SÃ³ pode explicar, alertar e lembrar aÃ§Ãµes
Todas as decisÃµes de fluxo devem ser feitas pelo engine de receita
7. UX obrigatÃ³ria
Nunca retornar â€œMissing required inputsâ€ sem:
Informar qual input Ã© esperado
Solicitar explicitamente o valor ao operador
O objetivo Ã© garantir que nenhuma etapa seja pulada, que inputs obrigatÃ³rios sejam sempre coletados no momento correto e que o fluxo siga estritamente o recipe.yml.